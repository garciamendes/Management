// react
import { all, call, put, takeLatest } from 'redux-saga/effects'

// third party
import { AxiosResponse } from 'axios'
import toast from 'react-hot-toast'

// Services
import { api, AuthTokenHeader } from '../../../services/Api'

// local
import { VulnerabilitiesTypes } from './types'
import { fetchVulnerabilitiesListSuccess } from './actions'


function* fetchVulnerabilitiesListSuccessSaga() {
  const response: AxiosResponse = yield call(api.get, `/api/vulnerabilities/?page=1`, {
    headers: {
      'Authorization': `token ${AuthTokenHeader}`
    }
  })

  if (response.status === 200) {  
    yield put(fetchVulnerabilitiesListSuccess(response.data))
  } else {
    toast.error('Erro')
  }

}

export default all([
  takeLatest(VulnerabilitiesTypes.FETCH_LIST, fetchVulnerabilitiesListSuccessSaga),
])